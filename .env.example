# ==============================================================================
# CLERK AUTHENTICATION (for documentation access)
# ==============================================================================
CLERK_JWKS_URI=https://<xyz>.accounts.dev/.well-known/jwks.json
CLERK_SECRET_KEY=sk_test_<xyz>

# ==============================================================================
# SERVER CONFIGURATION
# ==============================================================================
PORT=3001
FRONTEND_URL=http://localhost:3000

# ==============================================================================
# KEYCLOAK (Production - Primary Credential Source)
# ==============================================================================
# Keycloak is the PRIMARY source for workspace credentials in production
# Environment variables below serve as FALLBACK when Keycloak is not configured
#
# How it works:
# 1. If all KEYCLOAK_* vars are set, system fetches credentials from Keycloak
# 2. If KEYCLOAK_URL is empty or Keycloak fetch fails, falls back to env vars
# 3. Credentials should be stored in Keycloak client attributes:
#    - AUTH_CLIENT_ID
#    - AUTH_CLIENT_SECRET
#    - AUTH_TOKEN_URL
#    - NERV_FLOW_ID
#    - RECURRING_FLOW_ID
#    - FACTORY_API

# Keycloak Server Configuration
KEYCLOAK_URL=
# Example: https://id.finarkein.com/auth

KEYCLOAK_REALM=
# Example: fin-dev

KEYCLOAK_CLIENT_ID=
# Admin client ID with permission to read client attributes

KEYCLOAK_CLIENT_SECRET=
# Admin client secret

# ==============================================================================
# DEFAULT WORKSPACE CREDENTIALS (Development Fallback)
# ==============================================================================
# These are used when Keycloak is not configured
# Or as the default workspace when user doesn't have workspace metadata

# OAuth2 Configuration
AUTH_TOKEN_URL=https://id.finarkein.com/auth/realms/fin-dev/protocol/openid-connect/token
AUTH_CLIENT_ID=client-tsfsl-03d952d6
AUTH_CLIENT_SECRET=abcd

# API Configuration
FACTORY_API=https://api.finarkein.in/factory/v1
workspace=tsfsl

# Nerv Flow IDs
nerv.flow.id=376b71fe-009b-4154-850c-fa0eb65b4d5a
recurring.nerv.flow.id=2627928c-03d4-4fb4-a1fd-c2e1a42723cc

# ==============================================================================
# ADDITIONAL WORKSPACES (Development Only)
# ==============================================================================
# Format: {workspace_name}_AUTH_CLIENT_ID, {workspace_name}_AUTH_CLIENT_SECRET, etc.
# The workspace name is converted to lowercase and used as prefix
# Example: workspace "Demo" â†’ looks for demo_AUTH_CLIENT_ID

# Example: Demo Workspace
# demo_AUTH_CLIENT_ID=client-demo-xyz123
# demo_AUTH_CLIENT_SECRET=demo-secret-key
# demo_NERV_FLOW_ID=demo-flow-id-here
# demo_RECURRING_FLOW_ID=demo-recurring-flow-id

# Example: Acme Corp Workspace (workspace name: "Acme" or "acme")
# acme_AUTH_CLIENT_ID=client-acme-abc456
# acme_AUTH_CLIENT_SECRET=acme-secret-key
# acme_NERV_FLOW_ID=acme-flow-id-here
# acme_RECURRING_FLOW_ID=acme-recurring-flow-id

# ==============================================================================
# HOW IT WORKS
# ==============================================================================
# 1. Customer logs in via Clerk
# 2. Clerk JWT contains workspace in publicMetadata (e.g., "Acme" or "acme")
# 3. Backend converts workspace to lowercase and reads acme_AUTH_CLIENT_ID, acme_AUTH_CLIENT_SECRET, etc.
# 4. Frontend displays credentials at /credentials page
# 5. API calls auto-use these credentials (no manual input needed)
#
# Credential Priority:
# 1. Keycloak (if KEYCLOAK_URL is set) - tries to fetch from Keycloak first
# 2. Workspace-specific env vars (e.g., demo_AUTH_CLIENT_ID)
# 3. Default env vars (e.g., AUTH_CLIENT_ID)
#
# Production: Set KEYCLOAK_URL and credentials come from Keycloak
# Development: Leave KEYCLOAK_URL empty and use env vars above